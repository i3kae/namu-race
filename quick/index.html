<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wiki Race Quick</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #f9f9f9;
    }

    h1 {
      font-size: 3rem;
      color: #333;
      margin-bottom: 2rem;
    }

    #content {
      width: 80%;
      max-height: 60%;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      background-color: #fff;
    }
  </style>
</head>

<body>
  <h1>Wiki Race Quick</h1>
  <div id="content">로딩 중...</div>

  <script>
    async function loadExternalContent() {
      const url =
        "https://namu.wiki/w/%EB%93%9C%EB%9E%98%EA%B3%A4(%EC%96%BC%EC%9D%8C%EA%B3%BC%20%EB%B6%88%EC%9D%98%20%EB%85%B8%EB%9E%98)";
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Failed to fetch content");
        }
        const html = await response.text();
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;

        // Update external stylesheets to use the root URL of the original page
        const baseUrl = new URL(url);
        const stylesheets = tempDiv.querySelectorAll(
          "link[rel='stylesheet']"
        );
        stylesheets.forEach((link) => {
          const newLink = document.createElement("link");
          newLink.rel = "stylesheet";
          newLink.href = new URL(link.getAttribute("href"), baseUrl).href;
          document.head.appendChild(newLink);
        });

        // Update images using data-src attribute
        const images = tempDiv.querySelectorAll("img[data-src]");
        images.forEach((img) => {
          let dataSrc = img.getAttribute("data-src");
          if (dataSrc) {
            // 상대 경로가 있다면 절대 경로로 변환
            if (dataSrc.startsWith("//")) {
              dataSrc = "https:" + dataSrc;
            } else {
              dataSrc = new URL(dataSrc, baseUrl).href;
            }
            img.src = dataSrc;

            // SVG 플레이스홀더를 제거 (기존 src 속성 삭제)
            if (img.src.startsWith("data:image/svg+xml")) {
              img.removeAttribute("src");
              img.setAttribute("src", dataSrc);
            }
          }
        });

        // Extract and display the target content using XPath
        const xpath = '//*[@id="app"]/div[1]/div[2]/div/div[3]/div[2]';
        const xpathResult = document.evaluate(xpath, tempDiv, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
        const targetContent = xpathResult.singleNodeValue;
        document.getElementById("content").innerHTML = targetContent ?
          targetContent.innerHTML :
          "요청한 콘텐츠를 찾을 수 없습니다.";
      } catch (error) {
        document.getElementById("content").innerHTML =
          "외부 콘텐츠를 불러오지 못했습니다.";
        console.error(error);
      }
    }

    loadExternalContent();
  </script>
</body>

</html>